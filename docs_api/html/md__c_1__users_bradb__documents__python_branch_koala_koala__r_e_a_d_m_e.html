<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Koala: Koala</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Koala
   &#160;<span id="projectnumber">0.35</span>
   </div>
   <div id="projectbrief">A python module to extract all the content of an Excel document and enable calculation without Excel</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Koala </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/vallettea/koala"><img src="https://travis-ci.org/vallettea/koala.svg?branch=master" alt="Build Status" class="inline"/>
</a></p>
<p>Koala converts any Excel workbook into a python object that enables on the fly calculation without the need of Excel.</p>
<p>Koala parses an Excel workbook and creates a network of all the cells with their dependencies. It is then possible to change any value of a node and recompute all the depending cells.</p>
<h2>Get started</h2>
<h3>Installation</h3>
<p>Koala is available on pypi so you can just:</p>
<div class="fragment"><div class="line">pip install koala2</div></div><!-- fragment --><p>alternatively, you can download it and install the last version from github:</p>
<div class="fragment"><div class="line">git clone https://github.com/vallettea/koala.git</div><div class="line">cd koala</div><div class="line">python setup.py install</div></div><!-- fragment --><h3>Basic</h3>
<p><b>Koala is still in early stages of developement and feel free to leave us issues when you encounter a problem.</b></p>
<h4>Graph generation</h4>
<p>The first thing you need is to convert your workbook into a graph. This operation may take some time depending on the size of your workbook (we've used koalo on workbooks containg more than 100 000 intricated formulas).</p>
<div class="fragment"><div class="line">from koala.ExcelCompiler import ExcelCompiler</div><div class="line"></div><div class="line">sp = Spreadsheet(&quot;examples/basic.xlsx&quot;)</div></div><!-- fragment --><p>If this step fails, ensure that your Excel file is recent and in standalone mode (open it with Excel and save, it should rewrite the file and the resulting file should be three of four times heavier).</p>
<h4>Graph Serialization</h4>
<p>As the previous convertion can be long on big graphs, it is often useful to dump the graph to a file:</p>
<div class="fragment"><div class="line">sp.dump(&#39;file.gzip&#39;)</div></div><!-- fragment --><p>which can be relaoded later with:</p>
<div class="fragment"><div class="line">sp = Spreadsheet.load(&#39;file.gzip&#39;)</div></div><!-- fragment --><h4>Graph Evaluation</h4>
<p>You can read the values of some cells with <code>cell_evaluate</code>. It will only evaluate the calculation if a parent cell has been modified with <code>cell_set_value</code>.</p>
<div class="fragment"><div class="line">sp.cell_set_value(&#39;Sheet1!A1&#39;, 10)</div><div class="line">sp.cell_evaluate(&#39;Sheet1!D1&#39;)</div></div><!-- fragment --><h4>Named cells or range</h4>
<p>If your Excel file has names defined, you can use them freely:</p>
<div class="fragment"><div class="line">sp.cell_set_value(&#39;myNamedCell&#39;, 0)</div></div><!-- fragment --><h3>Advanced</h3>
<h4>Compiler options</h4>
<p>You can pass <code>ignore_sheets</code> to ignore a list of Sheets, and <code>ignore_hidden</code> to ignore all hidden cells:</p>
<div class="fragment"><div class="line">sp = Spreadsheet(file, ignore_sheets = [&#39;Sheet2&#39;], ignore_hidden = True)</div></div><!-- fragment --><p>In case you have very big files, you might want to reduce the size of the output graph. Here are a few methods.</p>
<h4>Volatiles</h4>
<p>Volatiles are functions that might output a reference to Cell rather than a specific value, which impose a reevaluation everytime. Typical examples are INDEX and OFFSET.</p>
<p>After having created the graph, you can use <code>clean_pointers</code> to fix the value of the pointers to their initial values, which reduces the graph size and decreases the evaluation times:</p>
<div class="fragment"><div class="line">sp.clean_pointers()</div></div><!-- fragment --><p><b>Warning:</b> this implies that Cells concerned by these functions will be fixed permanently. If you evaluate a cell whose modified parents are separated by a pointer, you may encounter errors. WIP: we are working on automatic detection of the required pointers.</p>
<h4>Outputs</h4>
<p>You can specify the outputs you need. In this case, all Cells not concerned in the calculation of these output Cell will be discarded, and your graph size wil be reduced.</p>
<div class="fragment"><div class="line">sp = sp.gen_graph(inputs=[&#39;Sheet1!A1&#39;], outputs=[&#39;Sheet1!D1&#39;, Sheet1!D2])</div></div><!-- fragment --><h4>Pruning inputs</h4>
<p>In this case, all Cells not impacted by inputs Cells will be discarded, and your graph size wil be reduced.</p>
<div class="fragment"><div class="line">sp = sp.prune_graph()</div></div><!-- fragment --><h4>Fix and free Cells</h4>
<p>You might need to fix a Cell, so that its value is not reevaluated. You can do that with:</p>
<div class="fragment"><div class="line">sp.cell_fix(&#39;Sheet1!D1&#39;)</div></div><!-- fragment --><p>By default, all Cells on which you use <code>sp.cell_set_value()</code> will be fixed.</p>
<p>You can free your fixed cells with:</p>
<div class="fragment"><div class="line">sp.cell_free(&#39;Sheet1!D1&#39;) # frees a single Cell</div><div class="line">sp.cell_free() # frees all fixed Cells</div></div><!-- fragment --><p>When you free a Cell, it is automatically reevaluated.</p>
<h4>Set formula</h4>
<p>If you need to change a Cell's formula, you can use:</p>
<div class="fragment"><div class="line">sp.cell_set_formula(&#39;Sheet1!D1&#39;, &#39;Sheet1!A1 * 1000&#39;)</div></div><!-- fragment --><p>The <code>string</code> you pass as argument needs to be written with Excel syntax.</p>
<p>** You will find more examples and sample excel files in the directory <code>examples</code>.**</p>
<h4>Detect alive</h4>
<p>To check if you have "alive pointers", i.e, pointer functions that have one of your inputs as argument, you can use:</p>
<div class="fragment"><div class="line">sp.detect_alive(inputs = [...], outputs = [...])</div></div><!-- fragment --><p>This will also change the <code>Spreadsheet.pointers_to_reset</code> list, so that only alive pointers are resetted on <code>cell_set_value()</code>.</p>
<h4>Create from scratch</h4>
<p>The graph can also be created from scratch (not by using a file).</p>
<div class="fragment"><div class="line">sp_scratch = Spreadsheet()</div><div class="line"></div><div class="line">sp_scratch.cell_add(&#39;Sheet1!A1&#39;, value=1)</div><div class="line">sp_scratch.cell_add(&#39;Sheet1!A2&#39;, value=2)</div><div class="line">sp_scratch.cell_add(&#39;Sheet1!A3&#39;, formula=&#39;=SUM(Sheet1!A1, Sheet1!A2)&#39;)</div><div class="line"></div><div class="line">sp_scratch.cell_evaluate(&#39;Sheet1!A3&#39;)</div></div><!-- fragment --><h2>Origins</h2>
<p>This project is a "double fork" of two awesome projects:</p><ul>
<li><a href="https://github.com/dgorissen/pycel">Pycel</a>, a python module that generates AST graph from a workbook</li>
<li><a href="http://openpyxl.readthedocs.io/en/default/">OpenPyXL</a>, a full API able to read/write/manipulate Excel 2010 files.</li>
</ul>
<p>The most work we did was to adapt <a href="https://github.com/dgorissen/pycel">Pycel</a> algorithm to more complex cases that it is capable of. This ended up in modifying some core parts of the library, especially with the introduction of <code>Range</code> objects.</p>
<p>As for <a href="http://openpyxl.readthedocs.io/en/default/">OpenPyXL</a>, we only took tiny bits, mainly concerning the reading part. Most of what we took from it is left unchanged in the <code>openpyxl</code> folder, with references to the original scripts on <a href="https://bitbucket.org/openpyxl/openpyxl">BitBucket</a>.</p>
<p>This module has been enriched by <a href="http://WeAreAnts.fr">Ants</a>, but is part of a more global project of <a href="http://www.engie.com/">Engie</a> company and particularly it Center of Expertise in Modelling and Economics Studies.</p>
<h2>Licence</h2>
<p>GPL </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
